{% extends 'dashboard/index.html' %}
{% load static %}

{% block extra_css %}
<style>
:root {
  --primary: #6366f1;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --dark: #1f2937;
  --border: #e5e7eb;
}

.management-hero {
  background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
  border-radius: 24px;
  padding: 3rem 2rem;
  margin-bottom: 2rem;
  color: white;
  position: relative;
  overflow: hidden;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 1.5rem;
  margin-bottom: 2rem;
}

.stat-card {
  background: white;
  border-radius: 16px;
  padding: 2rem;
  text-align: center;
  box-shadow: 0 4px 20px rgba(0,0,0,0.08);
  transition: all 0.3s ease;
}

.stat-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 8px 30px rgba(0,0,0,0.15);
}

.stat-number {
  font-size: 2.5rem;
  font-weight: bold;
  margin-bottom: 0.5rem;
}

.course-card {
  background: white;
  border-radius: 16px;
  padding: 1.5rem;
  box-shadow: 0 2px 10px rgba(0,0,0,0.05);
  transition: all 0.3s ease;
  margin-bottom: 1rem;
}

.course-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 25px rgba(0,0,0,0.1);
}

.status-badge {
  padding: 0.25rem 0.75rem;
  border-radius: 12px;
  font-size: 0.85rem;
  font-weight: 600;
}

.status-published {
  background: #dcfce7;
  color: #166534;
}

.status-draft {
  background: #fef3c7;
  color: #92400e;
}

.action-btn {
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 8px;
  padding: 0.5rem 1rem;
  text-decoration: none;
  transition: all 0.3s ease;
  display: inline-flex;
  align-items: center;
  gap: 0.5rem;
}

.action-btn:hover {
  background: #4338ca;
  color: white;
  text-decoration: none;
  transform: translateY(-1px);
}

.activity-item {
  background: white;
  border-radius: 12px;
  padding: 1rem;
  margin-bottom: 0.75rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.05);
  border-left: 4px solid var(--primary);
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
  <!-- Hero Section -->
  <div class="management-hero">
    <div class="row align-items-center">
      <div class="col-md-8">
        <h1 class="h2 mb-3">
          <i class="fas fa-graduation-cap me-2"></i>
          Quản Lý Khóa Học
        </h1>
        <p class="mb-0 opacity-90">
          Tạo và quản lý các khóa học lập trình của bạn. Theo dõi tiến độ học viên và phân tích hiệu quả.
        </p>
      </div>
      <div class="col-md-4 text-end">
        <a href="{% url 'course_management_create' %}" class="btn btn-light btn-lg">
          <i class="fas fa-plus me-2"></i>
          Tạo Khóa Học Mới
        </a>
      </div>
    </div>
  </div>

  <!-- Statistics Cards -->
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-number text-primary">{{ stats.total_courses }}</div>
      <div class="text-muted">Tổng Khóa Học</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-number text-success">{{ stats.published_courses }}</div>
      <div class="text-muted">Đã Publish</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-number text-warning">{{ stats.draft_courses }}</div>
      <div class="text-muted">Bản Nháp</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-number text-info">{{ stats.total_students }}</div>
      <div class="text-muted">Tổng Học Viên</div>
    </div>
    
    <div class="stat-card">
      <div class="stat-number text-secondary">{{ stats.total_lessons }}</div>
      <div class="text-muted">Tổng Bài Học</div>
    </div>
  </div>

  <div class="row">
    <!-- My Courses -->
    <div class="col-lg-8">
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4">
          <div class="d-flex justify-content-between align-items-center mb-4">
            <h5 class="card-title mb-0">
              <i class="fas fa-book text-primary me-2"></i>
              Khóa Học Của Tôi
            </h5>
            <a href="{% url 'course_management_create' %}" class="action-btn">
              <i class="fas fa-plus"></i>
              <span>Tạo mới</span>
            </a>
          </div>
          
          {% if recent_courses %}
          {% for course in recent_courses %}
          <div class="course-card">
            <div class="row align-items-center">
              <div class="col-md-8">
                <div class="d-flex justify-content-between align-items-start mb-2">
                  <h6 class="mb-0">{{ course.title }}</h6>
                  <span class="status-badge status-{{ course.status }}">
                    {% if course.status == 'published' %}
                      <i class="fas fa-check me-1"></i>Published
                    {% else %}
                      <i class="fas fa-edit me-1"></i>Draft
                    {% endif %}
                  </span>
                </div>
                
                <div class="text-muted small mb-2">
                  {{ course.language.display_name }} • {{ course.get_difficulty_display }}
                </div>
                
                <div class="row text-center">
                  <div class="col-4">
                    <div class="small text-muted">Học viên</div>
                    <div class="fw-bold text-primary">{{ course.total_enrollments }}</div>
                  </div>
                  <div class="col-4">
                    <div class="small text-muted">Đánh giá</div>
                    <div class="fw-bold text-warning">
                      {% if course.avg_rating %}
                        {{ course.avg_rating|floatformat:1 }} ★
                      {% else %}
                        --
                      {% endif %}
                    </div>
                  </div>
                  <div class="col-4">
                    <div class="small text-muted">Tạo</div>
                    <div class="fw-bold text-info">{{ course.created_at|date:"d/m/Y" }}</div>
                  </div>
                </div>
              </div>
              
              <div class="col-md-4 text-end">
                <div class="d-flex flex-column gap-2">
                  <a href="{% url 'course_management_edit' course.id %}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-edit me-1"></i>
                    Chỉnh sửa
                  </a>
                  <a href="{% url 'course_analytics' course.id %}" class="btn btn-outline-info btn-sm">
                    <i class="fas fa-chart-bar me-1"></i>
                    Thống kê
                  </a>
                </div>
              </div>
            </div>
          </div>
          {% endfor %}
          
          {% if user_courses.count > 5 %}
          <div class="text-center">
            <a href="#" class="btn btn-outline-primary">
              Xem tất cả {{ user_courses.count }} khóa học
            </a>
          </div>
          {% endif %}
          
          {% else %}
          <div class="text-center py-5">
            <i class="fas fa-book-open text-muted mb-3" style="font-size: 3rem;"></i>
            <h6 class="text-muted">Chưa có khóa học nào</h6>
            <p class="text-muted mb-3">Bắt đầu tạo khóa học đầu tiên của bạn!</p>
            <a href="{% url 'course_management_create' %}" class="btn btn-primary">
              <i class="fas fa-plus me-2"></i>
              Tạo Khóa Học Mới
            </a>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    
    <!-- Right Sidebar -->
    <div class="col-lg-4">
      <!-- Quick Actions -->
      <div class="card border-0 shadow-sm mb-4">
        <div class="card-body p-4">
          <h5 class="card-title mb-3">
            <i class="fas fa-bolt text-warning me-2"></i>
            Thao Tác Nhanh
          </h5>
          
          <div class="d-grid gap-2">
            <a href="{% url 'course_management_create' %}" class="btn btn-primary">
              <i class="fas fa-plus me-2"></i>
              Tạo Khóa Học Mới
            </a>
            
            <a href="#" class="btn btn-outline-primary">
              <i class="fas fa-upload me-2"></i>
              Import Khóa Học
            </a>
            
            <a href="#" class="btn btn-outline-info">
              <i class="fas fa-chart-line me-2"></i>
              Báo Cáo Tổng Quan
            </a>
          </div>
        </div>
      </div>
      
      <!-- Recent Activity -->
      <div class="card border-0 shadow-sm">
        <div class="card-body p-4">
          <h5 class="card-title mb-3">
            <i class="fas fa-history text-info me-2"></i>
            Hoạt Động Gần Đây
          </h5>
          
          {% if recent_enrollments %}
          {% for enrollment in recent_enrollments %}
          <div class="activity-item">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <div class="fw-bold">{{ enrollment.user.get_full_name|default:enrollment.user.username }}</div>
                <div class="text-muted small">đăng ký {{ enrollment.course.title }}</div>
                <div class="text-muted small">{{ enrollment.enrolled_at|timesince }} trước</div>
              </div>
              <div class="text-end">
                <i class="fas fa-user-plus text-success"></i>
              </div>
            </div>
          </div>
          {% endfor %}
          {% else %}
          <div class="text-center py-3">
            <i class="fas fa-clock text-muted mb-2" style="font-size: 2rem;"></i>
            <p class="text-muted mb-0">Chưa có hoạt động nào</p>
          </div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %}